function retirarDiv(e,t=1,i=0){for(let i=0;i<t;i++)e=e.parentElement;const n=e.dataset.templateType;conditions.hasOwnProperty(n)||(e.remove(),removeFromPool(e));let o=e.parentElement;const s=Array.from(o.children).indexOf(e)-i;let a;for(;!(a=o.parentElement.querySelector("[data-id]"));)o=o.parentElement;const r=a.dataset.id;e.remove(),console.log(`conditions[${n}].delete(idElement, ${r}, ${s});`),console.log(a),conditions[n].delete(a,r,s)}function removeFromPool(e){const t=e.querySelector("[data-id]");if(!t)return;const i=e.dataset.templateType;if(!i)return;const n=pools[i];if(!n)return;const o=t.dataset.id,s=parseInt(o);n.delete(o),isNaN(s)?n.idPool.delete(o):n.idPool.delete(s)}function set(e,t,i=!1,n,o=!1){if(!i)return void(t[n]=e.value);const s=e.parentElement.querySelector("[data-id]").dataset.id;if(o)return obj=t.find((e=>e.id==s)),void(obj[n]=e.value);n?t[s][n]=e.value:t[s]=e.value}function isIdElementActuallyALevelElement(e,t){const i=e?.parentElement?.parentElement?.parentElement;return i==t?.parentElement?.parentElement?.parentElement}function setCondition(e,t,i,n,o,s){let a,r;s&&(a="value");let l=e.parentElement;const d=Array.from(l.parentElement.children).indexOf(e.parentElement)-i;for(;;)if(r=l.querySelector("[data-id]"),r)if(a){if(!isIdElementActuallyALevelElement(r,a))break;l=l.parentElement}else a=r;else l=l.parentElement;const c=r.dataset.id,p=a.dataset?.id??a;console.log(c),console.log(p);const u=t.find((e=>e.id==c));console.log(u);const f=u[p];console.log(f);let m=f[d];console.log(m),o&&(m=m.conditions[0]),console.log(m),m[n]=e.value}function addToPool(e,t,i){if(""===i)return;let n=e.dataset.id;const o=parseInt(n);n=isNaN(o)?n:o,delete o;const s=pools[t];if(s){if(i)s.idPool.delete(n),s.edit(n,i);else{for(;s.idPool.has(n);)n++;i=n,s.add(i),e.innerText=e.innerText.replace("{}",i)}s.idPool.add(i),i!=n&&s.idPool.has(n)||(e.dataset.id=i)}}function tryAddCondition(e,t){if(console.log(t),!conditions.hasOwnProperty(t))return;let i,n=e.parentElement;for(;!(i=n.parentElement.querySelector("[data-id]"));)n=n.parentElement;const o=i.dataset.id;conditions[t].add(i,o)}function adicionarDiv(e,t){const i=templates[t].cloneNode(!0);e.parentElement.insertBefore(i,e);const n=i.querySelector("[data-id]");if(tryAddCondition(e,t),!n)return;addToPool(n,t);const o=i.querySelector(".expertise-conditions-parent");o&&o.dispatchEvent(new Event("change"))}function populateWithGroup(e,t){const i=Array.from(e.querySelectorAll("[data-id]")).map((e=>e.dataset.id));for(const n of niveisPericias){if(i.includes(n.id))continue;const o=templates[t].cloneNode(!0);e.appendChild(o);const s=o.querySelector("[data-id]");s&&(s.dataset.id=n.id,s.innerText=s.innerText.replace("{}",n.id))}}const conditions={condition_attribute:{add(e,t){const i=atributos.find((e=>e.id==t));i.value.splice(i.value.length-1,0,{conditions:[{type:"ge",left:"",right:""}],dice:""})},delete(e,t,i){atributos.find((e=>e.id==t)).value.splice(i,1)}},condition_expertise:{add(e,t){let i=e,n=i.parentElement;for(;i=n.querySelector("[data-id]"),!i||isIdElementActuallyALevelElement(i,e);)n=n.parentElement;const o=i.dataset.id,s=pericias.find((e=>e.id==o));console.log(o),console.log(t),console.log(s),console.log(s[t]),s[t].splice(s[t].length-1,0,{conditions:[{type:"ge",left:"",right:""}],dice:""})},delete(e,t,i){let n=e,o=n.parentElement;for(;n=o.querySelector("[data-id]"),!n||!isIdElementActuallyALevelElement(n,e);)o=o.parentElement;const s=n.dataset.id;pericias.find((e=>e.id==s))[t].splice(i,1)}}},ids={linguas:new Set(["default"]),atributos:new Set([101,102]),pericias:new Set,niveisPericias:new Set(["false"])};function setDefaultStringRecursively(e,t=""){for(const i in e)"object"!=typeof e[i]?"string"==typeof e[i]&&(e[i]=t):setDefaultStringRecursively(e[i],t);return e}const pools={status:{idPool:ids.atributos,add(e){for(const t in i18n){i18n[t].status[e]={label:"",display:""}}statusObj.push({id:e,emoji:""})},delete(e){for(const t in i18n){delete i18n[t].status[e]}for(let t=0;t<statusObj.length;t++){if(statusObj[t].id==e)return void statusObj.splice(t,1)}}},attribute:{idPool:ids.atributos,add(e){for(const t in i18n){i18n[t].ficha[e]=""}atributos.push({id:e,emoji:"",value:[{dice:""}]})},delete(e){for(const t in i18n){delete i18n[t].ficha[e]}for(let t=0;t<atributos.length;t++){if(atributos[t].id==e)return void atributos.splice(t,1)}}},expertise:{idPool:ids.pericias,add(e){for(const t in i18n){i18n[t].pericias[e]=""}const t={id:e,emoji:""};for(const e of niveisPericias)t[e.id]=[{dice:""}];pericias.push(t)},delete(e){console.log(e);for(const t in i18n){delete i18n[t].pericias[e]}for(let t=0;t<pericias.length;t++){if(pericias[t].id==e)return void pericias.splice(t,1)}}},expertise_level:{idPool:ids.niveisPericias,add(e){if(this.idPool.has(e))return;for(const t in i18n){i18n[t].cmds.editar_pericias.niveis[e]={label:"",display:""}}for(const t of pericias)t[e]=[{dice:""}];niveisPericias.push({id:e,emoji:""});const t=document.getElementsByClassName("expertise-conditions-parent");for(const i of t){const t=templates.condition_group_expertise.cloneNode(!0);i.appendChild(t);const n=t.querySelector("[data-id]");n&&(n.dataset.id=e,n.innerText=n.innerText.replace("{}",e))}},edit(e,t){if(this.idPool.has(t))return;if(!niveisPericias.find((i=>e===i.id&&(i.id=t,!0))))return this.add(t);for(const i in i18n){const n=i18n[i].cmds.editar_pericias.niveis;n[t]=n[e],delete n[e]}const i=document.getElementsByClassName("expertise-conditions-parent");for(const n of i){const i=n.querySelector(`[data-id=${e}]`);i&&(i.innerText=i.innerText.replace(e,t),i.dataset.id=t)}},delete(e){for(const t in i18n){delete i18n[t].cmds.editar_pericias.niveis[e]}for(let t=0;t<niveisPericias.length;t++){if(niveisPericias[t].id==e){niveisPericias.splice(t,1);break}}const t=document.getElementsByClassName("expertise-conditions-parent");for(const i of t)for(const t of i.children){if(t.querySelector(`[data-id=${e}]`)){t.remove();break}}}},language:{idPool:ids.linguas,add(e){i18n[e]=JSON.parse(JSON.stringify(i18n.default)),setDefaultStringRecursively(i18n[e])},edit(e,t){i18n[t]=i18n[e],delete i18n[e]},delete(e){delete i18n[e]}}},i18n={default:{hp:{current:{label:"",id:101},max:{label:"",id:102},display:""},status:{},ficha:{},pericias:{},cmds:{config:{label:"",emoji:"",description:""},di:{title:"",img:"",placeholder:{atributos:"",pericias:""},footer:""},editar_pericias:{niveis:{false:""}}}}},niveisPericias=[{id:"false",emoji:""}],statusObj=[],atributos=[],pericias=[],finalObject={i18n:i18n,niveis_pericias:niveisPericias,status:statusObj,atributos:atributos,pericias:pericias},templatesArray=document.getElementsByClassName("template"),templates={};for(let e=templatesArray.length-1;e>=0;e--){const t=templatesArray[e];templates[t.dataset.templateType]=t,t.classList.remove("d-none","template"),t.remove()}delete templatesArray;